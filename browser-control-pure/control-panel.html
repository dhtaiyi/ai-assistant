<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Browser Control Panel</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
            color: white;
        }
        .container { max-width: 800px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; font-size: 28px; }
        
        .status {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
            font-size: 18px;
        }
        .status.connected { background: rgba(102, 187, 106, 0.3); }
        .status.disconnected { background: rgba(239, 83, 80, 0.3); }
        
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card h3 { 
            margin-bottom: 20px; 
            color: #667eea; 
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { 
            display: block; 
            margin-bottom: 8px; 
            font-size: 14px; 
            color: #666; 
        }
        .input-group input { 
            width: 100%; 
            padding: 15px; 
            border: 2px solid #ddd; 
            border-radius: 10px;
            font-size: 16px;
        }
        .input-group input:focus { outline: none; border-color: #667eea; }
        
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: all 0.2s;
        }
        .btn:hover { transform: scale(1.02); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .btn-secondary { background: #f5f5f5; color: #333; }
        
        .quick-links { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .quick-link {
            padding: 12px 20px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .quick-link:hover { background: #667eea; color: white; }
        
        .result {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .command-btn {
            padding: 15px;
            background: #f0f0f0;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
        }
        .command-btn:hover { background: #667eea; color: white; }
        
        .tabs { display: flex; margin-bottom: 20px; }
        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            background: rgba(255,255,255,0.2);
            cursor: pointer;
            border-radius: 10px;
            margin-right: 10px;
        }
        .tab.active { background: white; color: #667eea; }
        
        .panel { display: none; }
        .panel.active { display: block; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– OpenClaw Browser Control</h1>
        
        <div class="status connected" id="status">ğŸŸ¢ å·²è¿æ¥ - ç­‰å¾…å‘½ä»¤</div>
        
        <div class="tabs">
            <div class="tab active" data-tab="navigate">å¯¼èˆª</div>
            <div class="tab" data-tab="operate">æ“ä½œ</div>
            <div class="tab" data-tab="data">æ•°æ®</div>
            <div class="tab" data-tab="advanced">é«˜çº§</div>
        </div>
        
        <!-- å¯¼èˆªé¢æ¿ -->
        <div class="panel active" id="navigate-panel">
            <div class="card">
                <h3>ğŸŒ æ‰“å¼€ç½‘é¡µ</h3>
                <div class="input-group">
                    <input type="text" id="url-input" placeholder="è¾“å…¥URLï¼Œå¦‚ https://www.10jqka.com.cn">
                </div>
                <button class="btn btn-success" onclick="navigate()">ğŸš€ è·³è½¬</button>
                
                <div class="quick-links">
                    <div class="quick-link" onclick="go('https://www.10jqka.com.cn')">ğŸ“ˆ åŒèŠ±é¡º</div>
                    <div class="quick-link" onclick="go('https://quote.eastmoney.com')">ğŸ’° ä¸œæ–¹è´¢å¯Œ</div>
                    <div class="quick-link" onclick="go('https://xueqiu.com')">ğŸ¯ é›ªçƒ</div>
                    <div class="quick-link" onclick="go('https://www.baidu.com')">ğŸ” ç™¾åº¦</div>
                    <div class="quick-link" onclick="refresh()">ğŸ”„ åˆ·æ–°</div>
                </div>
            </div>
        </div>
        
        <!-- æ“ä½œé¢æ¿ -->
        <div class="panel" id="operate-panel">
            <div class="card">
                <h3>ğŸ‘† ç‚¹å‡»å…ƒç´ </h3>
                <div class="input-group">
                    <input type="text" id="click-selector" placeholder="CSSé€‰æ‹©å™¨ï¼Œå¦‚ .btn-primary, #submit-btn">
                </div>
                <button class="btn btn-primary" onclick="click()">ğŸ‘† ç‚¹å‡»</button>
            </div>
            
            <div class="card">
                <h3>âŒ¨ï¸ è¾“å…¥æ–‡æœ¬</h3>
                <div class="grid">
                    <div class="input-group">
                        <input type="text" id="type-selector" placeholder="é€‰æ‹©å™¨">
                    </div>
                    <div class="input-group">
                        <input type="text" id="type-text" placeholder="æ–‡æœ¬å†…å®¹">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="type()">âŒ¨ï¸ è¾“å…¥</button>
            </div>
            
            <div class="card">
                <h3>ğŸ“œ æ»šåŠ¨é¡µé¢</h3>
                <div class="grid">
                    <button class="command-btn" onclick="scroll('up', 300)">â¬†ï¸ å‘ä¸Š</button>
                    <button class="command-btn" onclick="scroll('down', 300)">â¬‡ï¸ å‘ä¸‹</button>
                    <button class="command-btn" onclick="scroll('top')">â¬†ï¸ é¡¶éƒ¨</button>
                    <button class="command-btn" onclick="scroll('bottom')">â¬‡ï¸ åº•éƒ¨</button>
                </div>
            </div>
        </div>
        
        <!-- æ•°æ®é¢æ¿ -->
        <div class="panel" id="data-panel">
            <div class="card">
                <h3>ğŸ“Š åŒèŠ±é¡ºæ•°æ®</h3>
                <button class="btn btn-success" onclick="getStockData()">ğŸ“ˆ è·å–è‚¡ç¥¨ä»·æ ¼</button>
                <button class="btn btn-secondary" onclick="getPageHTML()">ğŸ“„ è·å–é¡µé¢HTML</button>
                <button class="btn btn-secondary" onclick="getPageText()">ğŸ“ è·å–é¡µé¢æ–‡æœ¬</button>
            </div>
            
            <div class="card">
                <h3>ğŸ” æŸ¥æ‰¾å…ƒç´ </h3>
                <div class="input-group">
                    <input type="text" id="find-selector" placeholder="CSSé€‰æ‹©å™¨">
                </div>
                <button class="btn btn-secondary" onclick="find()">ğŸ” æŸ¥æ‰¾å…ƒç´ </button>
            </div>
        </div>
        
        <!-- é«˜çº§é¢æ¿ -->
        <div class="panel" id="advanced-panel">
            <div class="card">
                <h3>ğŸ’» æ‰§è¡ŒJavaScript</h3>
                <div class="input-group">
                    <input type="text" id="js-code" placeholder="document.title">
                </div>
                <button class="btn btn-secondary" onclick="evaluate()">ğŸ’» æ‰§è¡Œ</button>
            </div>
            
            <div class="card">
                <h3>ğŸ“‹ å†å²è®°å½•</h3>
                <button class="btn btn-secondary" onclick="clearHistory()">ğŸ—‘ï¸ æ¸…é™¤å†å²</button>
                <div id="history-list" style="margin-top: 10px; font-size: 12px; color: #666;"></div>
            </div>
        </div>
        
        <!-- ç»“æœ -->
        <div class="card">
            <h3>ğŸ“‹ æ‰§è¡Œç»“æœ</h3>
            <div class="result" id="result">ç­‰å¾…å‘½ä»¤...</div>
        </div>
    </div>

    <script>
        let history = [];
        
        // Tabåˆ‡æ¢
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', function() {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
                this.classList.add('active');
                document.getElementById(this.dataset.tab + '-panel').classList.add('active');
            });
        });

        // æ£€æŸ¥è¿æ¥
        async function checkConnection() {
            const statusEl = document.getElementById('status');
            try {
                const response = await chrome.runtime.sendMessage({ action: 'getStatus' });
                if (chrome.runtime.lastError || !response) {
                    statusEl.className = 'status disconnected';
                    statusEl.textContent = 'ğŸ”´ æœªè¿æ¥ - è¯·ç¡®ä¿æ‰©å±•å·²å®‰è£…';
                    return false;
                }
                statusEl.className = 'status connected';
                statusEl.textContent = 'ğŸŸ¢ å·²è¿æ¥ - ç­‰å¾…å‘½ä»¤';
                return true;
            } catch (e) {
                statusEl.className = 'status disconnected';
                statusEl.textContent = 'ğŸ”´ æœªè¿æ¥ - è¯·ç¡®ä¿æ‰©å±•å·²å®‰è£…';
                return false;
            }
        }
        
        checkConnection();
        setInterval(checkConnection, 3000);

        // æ‰§è¡Œå‘½ä»¤
        async function execute(command) {
            const time = new Date().toLocaleTimeString();
            showResult(`[${time}] æ‰§è¡Œå‘½ä»¤: ${command.type || 'unknown'}...`, 'info');
            
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'execute',
                    command: command
                });
                
                if (response.success) {
                    const result = response.result || response;
                    const formatted = typeof result === 'object' 
                        ? JSON.stringify(result, null, 2) 
                        : String(result);
                    
                    showResult(`[${time}] âœ… æˆåŠŸ\n${formatted}`, 'success');
                    addToHistory(command.type, 'æˆåŠŸ');
                    
                    // ä¿å­˜åˆ°localStorage
                    localStorage.setItem('openclaw_last_result', formatted);
                } else {
                    showResult(`[${time}] âŒ å¤±è´¥: ${response.error || 'æœªçŸ¥é”™è¯¯'}`, 'error');
                    addToHistory(command.type, 'å¤±è´¥');
                }
            } catch (error) {
                showResult(`[${time}] âŒ é”™è¯¯: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(text, type) {
            const el = document.getElementById('result');
            el.textContent = text;
            el.className = 'result';
        }

        // æ·»åŠ åˆ°å†å²
        function addToHistory(cmd, status) {
            history.unshift({ cmd, status, time: new Date().toLocaleTimeString() });
            if (history.length > 10) history.pop();
            updateHistoryDisplay();
        }

        function updateHistoryDisplay() {
            const el = document.getElementById('history-list');
            el.innerHTML = history.map(h => 
                `<div>[${h.time}] ${h.cmd} - ${h.status}</div>`
            ).join('');
        }

        // å‘½ä»¤å‡½æ•°
        function navigate() {
            const url = document.getElementById('url-input').value;
            if (url) execute({ type: 'navigate', url });
        }

        function go(url) {
            document.getElementById('url-input').value = url;
            execute({ type: 'navigate', url });
        }

        function refresh() {
            execute({ type: 'navigate', url: 'current' });
        }

        function click() {
            const selector = document.getElementById('click-selector').value;
            if (selector) execute({ type: 'click', selector });
        }

        function type() {
            const selector = document.getElementById('type-selector').value;
            const text = document.getElementById('type-text').value;
            if (selector && text) execute({ type: 'type', selector, text });
        }

        function scroll(direction, amount) {
            execute({ type: 'scroll', direction, amount: amount || 500 });
        }

        function getStockData() {
            execute({ type: 'getStockData' });
        }

        function getPageHTML() {
            execute({ type: 'getHTML' });
        }

        function getPageText() {
            execute({ type: 'evaluate', code: 'document.body.innerText.substring(0, 2000)' });
        }

        function find() {
            const selector = document.getElementById('find-selector').value;
            if (selector) {
                execute({ 
                    type: 'evaluate', 
                    code: `JSON.stringify(Array.from(document.querySelectorAll('${selector}')).map((el,i)=>({i,tag:el.tagName,text:el.innerText?.substring(0,50)})))` 
                });
            }
        }

        function evaluate() {
            const code = document.getElementById('js-code').value;
            if (code) execute({ type: 'evaluate', code });
        }

        function clearHistory() {
            history = [];
            updateHistoryDisplay();
            localStorage.removeItem('openclaw_last_result');
            showResult('å†å²å·²æ¸…é™¤', 'info');
        }

        // æ¢å¤ä¸Šæ¬¡ç»“æœ
        const lastResult = localStorage.getItem('openclaw_last_result');
        if (lastResult) {
            showResult('ä¸Šæ¬¡ç»“æœ:\n' + lastResult, 'info');
        }
    </script>
</body>
</html>
