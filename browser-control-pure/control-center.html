<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenClaw Browser Control Center</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: white;
        }
        .container { max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 30px; }
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            color: #333;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .card h3 { margin-bottom: 15px; color: #667eea; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; font-size: 14px; color: #666; }
        .input-group input { 
            width: 100%; 
            padding: 12px; 
            border: 2px solid #ddd; 
            border-radius: 8px;
            font-size: 16px;
        }
        .input-group input:focus { outline: none; border-color: #667eea; }
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin-bottom: 10px;
            transition: transform 0.2s;
        }
        .btn:hover { transform: scale(1.02); }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-success { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; }
        .btn-secondary { background: #f5f5f5; color: #333; }
        .result {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            font-size: 14px;
            max-height: 200px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-top: 15px;
        }
        .quick-links { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .quick-link {
            padding: 10px 20px;
            background: #f0f0f0;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        .quick-link:hover { background: #667eea; color: white; }
        .status { text-align: center; padding: 10px; margin-bottom: 20px; border-radius: 10px; }
        .status.connected { background: rgba(102, 187, 106, 0.3); }
        .status.disconnected { background: rgba(239, 83, 80, 0.3); }
        .command-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .command-row input { flex: 1; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¤– OpenClaw æµè§ˆå™¨æ§åˆ¶ä¸­å¿ƒ</h1>
        
        <div class="status connected" id="status">ğŸŸ¢ å·²è¿æ¥ - ç­‰å¾…å‘½ä»¤</div>
        
        <!-- å¯¼èˆª -->
        <div class="card">
            <h3>ğŸŒ å¯¼èˆª</h3>
            <div class="input-group">
                <input type="text" id="url-input" placeholder="è¾“å…¥URLï¼Œå¦‚ https://www.10jqka.com.cn">
            </div>
            <button class="btn btn-success" onclick="navigate()">ğŸš€ è·³è½¬</button>
            <div class="quick-links">
                <div class="quick-link" onclick="go('https://www.10jqka.com.cn')">åŒèŠ±é¡º</div>
                <div class="quick-link" onclick="go('https://quote.eastmoney.com')">ä¸œæ–¹è´¢å¯Œ</div>
                <div class="quick-link" onclick="go('https://xueqiu.com')">é›ªçƒ</div>
                <div class="quick-link" onclick="refresh()">ğŸ”„ åˆ·æ–°</div>
            </div>
        </div>
        
        <!-- æ“ä½œ -->
        <div class="card">
            <h3>ğŸ‘† æ“ä½œ</h3>
            <div class="command-row">
                <input type="text" id="click-selector" placeholder="CSSé€‰æ‹©å™¨ï¼Œå¦‚ .btn-primary">
                <button class="btn btn-primary" style="width: auto;" onclick="click()">ç‚¹å‡»</button>
            </div>
            <div class="command-row">
                <input type="text" id="type-selector" placeholder="é€‰æ‹©å™¨">
                <input type="text" id="type-text" placeholder="æ–‡æœ¬å†…å®¹">
            </div>
            <button class="btn btn-primary" onclick="type()">âŒ¨ï¸ è¾“å…¥</button>
        </div>
        
        <!-- æ•°æ® -->
        <div class="card">
            <h3>ğŸ“Š æ•°æ®</h3>
            <button class="btn btn-success" onclick="getStockData()">ğŸ“ˆ è·å–åŒèŠ±é¡ºæ•°æ®</button>
            <button class="btn btn-secondary" onclick="getPageInfo()">ğŸ“„ é¡µé¢ä¿¡æ¯</button>
            <button class="btn btn-secondary" onclick="evaluate('document.title')">æ ‡é¢˜</button>
        </div>
        
        <!-- ç»“æœ -->
        <div class="card">
            <h3>ğŸ“‹ æ‰§è¡Œç»“æœ</h3>
            <div class="result" id="result">ç­‰å¾…å‘½ä»¤...</div>
        </div>
    </div>

    <script>
        // çŠ¶æ€
        let isConnected = false;
        let commandQueue = [];
        let lastResult = null;

        // è¿æ¥æ£€æŸ¥
        function checkConnection() {
            // å°è¯•ä¸æ‰©å±•é€šä¿¡
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({ action: 'getStatus' }, response => {
                    if (chrome.runtime.lastError) {
                        setStatus(false);
                    } else if (response) {
                        isConnected = true;
                        setStatus(true);
                        startPolling();
                    }
                });
            }
        }

        function setStatus(connected) {
            const el = document.getElementById('status');
            if (connected) {
                el.className = 'status connected';
                el.textContent = 'ğŸŸ¢ å·²è¿æ¥ - ç­‰å¾…å‘½ä»¤';
            } else {
                el.className = 'status disconnected';
                el.textContent = 'ğŸ”´ æœªè¿æ¥ - è¯·ç¡®ä¿æ‰©å±•å·²å®‰è£…';
            }
        }

        // è½®è¯¢å‘½ä»¤ï¼ˆæœ¬åœ°å­˜å‚¨æ–¹å¼ï¼‰
        function startPolling() {
            setInterval(async () => {
                try {
                    const response = await chrome.runtime.sendMessage({ action: 'getStatus' });
                    if (response) {
                        setStatus(true);
                    }
                } catch (e) {
                    setStatus(false);
                }
            }, 2000);
        }

        // æ‰§è¡Œå‘½ä»¤
        async function execute(command) {
            showResult('æ‰§è¡Œä¸­...', 'info');
            
            try {
                const response = await chrome.runtime.sendMessage({
                    action: 'execute',
                    command: command
                });
                
                if (response.success) {
                    showResult(formatResult(response.result || response), 'success');
                    lastResult = response;
                } else {
                    showResult('å¤±è´¥: ' + response.error, 'error');
                }
            } catch (error) {
                showResult('é”™è¯¯: ' + error.message, 'error');
            }
        }

        // æ ¼å¼åŒ–ç»“æœ
        function formatResult(result) {
            if (result === null || result === undefined) return 'âœ… æ‰§è¡ŒæˆåŠŸ';
            if (typeof result === 'object') return JSON.stringify(result, null, 2);
            return String(result);
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(text, type) {
            const el = document.getElementById('result');
            const time = new Date().toLocaleTimeString();
            el.textContent = `[${time}] ${text}`;
            el.className = 'result';
        }

        // å‘½ä»¤å‡½æ•°
        function navigate() {
            const url = document.getElementById('url-input').value;
            if (url) execute({ type: 'navigate', url });
        }

        function go(url) {
            document.getElementById('url-input').value = url;
            execute({ type: 'navigate', url });
        }

        function refresh() {
            execute({ type: 'navigate', url: 'current' });
        }

        function click() {
            const selector = document.getElementById('click-selector').value;
            if (selector) execute({ type: 'click', selector });
        }

        function type() {
            const selector = document.getElementById('type-selector').value;
            const text = document.getElementById('type-text').value;
            if (selector && text) execute({ type: 'type', selector, text });
        }

        function getStockData() {
            execute({ type: 'getStockData' });
        }

        function getPageInfo() {
            execute({ type: 'getPageInfo' });
        }

        function evaluate(code) {
            execute({ type: 'evaluate', code: code });
        }

        // åˆå§‹åŒ–
        checkConnection();
        setInterval(checkConnection, 5000);
    </script>
</body>
</html>
